# =============================================================================
# SkysPy - Environment Variables
# =============================================================================
# Copy this file to .env and customize for your deployment
# =============================================================================

# -----------------------------------------------------------------------------
# Django Settings
# -----------------------------------------------------------------------------
DEBUG=False
DJANGO_SECRET_KEY=your-super-secret-key-change-this-in-production
ALLOWED_HOSTS=*
DJANGO_LOG_LEVEL=INFO

# Default superuser (auto-created on startup if doesn't exist)
DJANGO_SUPERUSER_USERNAME=admin
DJANGO_SUPERUSER_EMAIL=admin@example.com
DJANGO_SUPERUSER_PASSWORD=changeme

# -----------------------------------------------------------------------------
# Authentication & Authorization
# -----------------------------------------------------------------------------
# Auth Mode: public | private | hybrid
#   - public: No authentication required for any endpoint
#   - private: Authentication required for all endpoints
#   - hybrid: Per-feature access control (default)
AUTH_MODE=hybrid

# JWT Configuration
JWT_SECRET_KEY=                              # Defaults to DJANGO_SECRET_KEY if not set
JWT_ACCESS_TOKEN_LIFETIME_MINUTES=60
JWT_REFRESH_TOKEN_LIFETIME_DAYS=7
JWT_AUTH_COOKIE=False                        # Use httpOnly cookie for refresh token

# Local Authentication
LOCAL_AUTH_ENABLED=True

# API Key Authentication
API_KEY_ENABLED=True

# -----------------------------------------------------------------------------
# OIDC Configuration (Optional - for SSO)
# -----------------------------------------------------------------------------
# Enable OIDC for Single Sign-On with identity providers like:
#   - Keycloak, Authentik, Authelia
#   - Azure AD / Entra ID
#   - Okta, Auth0
#   - Google Workspace, GitHub (via OIDC)
#
OIDC_ENABLED=False
OIDC_PROVIDER_NAME=SSO                       # Display name shown on login button

# Provider URL (authorization server base URL)
# Examples:
#   Keycloak:   https://keycloak.example.com/realms/skyspy
#   Authentik:  https://authentik.example.com/application/o/skyspy
#   Azure AD:   https://login.microsoftonline.com/{tenant-id}/v2.0
#   Okta:       https://dev-12345.okta.com
#   Auth0:      https://your-tenant.auth0.com
OIDC_PROVIDER_URL=

# Client credentials (from your OIDC provider)
OIDC_CLIENT_ID=
OIDC_CLIENT_SECRET=

# Scopes to request (space-separated)
# Common scopes: openid profile email
# For group/role mapping, add: groups roles
OIDC_SCOPES=openid profile email groups

# Default role for new OIDC users (before claim mapping applies)
# Options: viewer, operator, analyst, admin
OIDC_DEFAULT_ROLE=viewer

# -----------------------------------------------------------------------------
# OIDC Examples by Provider
# -----------------------------------------------------------------------------
#
# === Keycloak ===
# 1. Create a new client in your realm with:
#    - Client Protocol: openid-connect
#    - Access Type: confidential
#    - Valid Redirect URIs: https://skyspy.example.com/api/v1/auth/oidc/callback/
# 2. In Client Scopes, ensure 'groups' scope includes group membership
# 3. Set environment variables:
#    OIDC_PROVIDER_URL=https://keycloak.example.com/realms/skyspy
#    OIDC_CLIENT_ID=skyspy-client
#    OIDC_CLIENT_SECRET=<client-secret-from-credentials-tab>
#
# === Authentik ===
# 1. Create an OAuth2/OIDC Provider
# 2. Create an Application linked to the provider
# 3. Set Redirect URI: https://skyspy.example.com/api/v1/auth/oidc/callback/
# 4. Set environment variables:
#    OIDC_PROVIDER_URL=https://authentik.example.com/application/o/skyspy
#    OIDC_CLIENT_ID=<client-id>
#    OIDC_CLIENT_SECRET=<client-secret>
#
# === Azure AD / Entra ID ===
# 1. Register an App in Azure Portal > App registrations
# 2. Add redirect URI: https://skyspy.example.com/api/v1/auth/oidc/callback/
# 3. Create a client secret in Certificates & secrets
# 4. Set environment variables:
#    OIDC_PROVIDER_URL=https://login.microsoftonline.com/{tenant-id}/v2.0
#    OIDC_CLIENT_ID=<application-client-id>
#    OIDC_CLIENT_SECRET=<client-secret-value>
#    OIDC_SCOPES=openid profile email
#
# === Authelia ===
# 1. Add OIDC client configuration to authelia configuration.yml
# 2. Set environment variables:
#    OIDC_PROVIDER_URL=https://auth.example.com
#    OIDC_CLIENT_ID=skyspy
#    OIDC_CLIENT_SECRET=<your-secret>
#

# -----------------------------------------------------------------------------
# Database (PostgreSQL)
# -----------------------------------------------------------------------------
POSTGRES_USER=adsb
POSTGRES_PASSWORD=adsb
POSTGRES_DB=adsb
# DATABASE_URL is auto-constructed in docker-compose

# -----------------------------------------------------------------------------
# Redis
# -----------------------------------------------------------------------------
REDIS_URL=redis://redis:6379/0

# -----------------------------------------------------------------------------
# API Configuration
# -----------------------------------------------------------------------------
API_PORT=8000

# -----------------------------------------------------------------------------
# ADS-B Data Sources
# -----------------------------------------------------------------------------
# Ultrafeeder (readsb/tar1090)
ULTRAFEEDER_HOST=ultrafeeder
ULTRAFEEDER_PORT=80

# Dump978 (UAT)
DUMP978_HOST=dump978
DUMP978_PORT=80

# -----------------------------------------------------------------------------
# Feeder Location (your antenna position)
# -----------------------------------------------------------------------------
FEEDER_LAT=47.9377
FEEDER_LON=-121.9687

# -----------------------------------------------------------------------------
# Polling Configuration
# -----------------------------------------------------------------------------
POLLING_INTERVAL=2                           # Seconds between ADS-B polls
DB_STORE_INTERVAL=5                          # Seconds between database writes
SESSION_TIMEOUT_MINUTES=30                   # Minutes before aircraft session ends

# -----------------------------------------------------------------------------
# Caching
# -----------------------------------------------------------------------------
CACHE_TTL=5                                  # Cache time-to-live in seconds
UPSTREAM_API_MIN_INTERVAL=60                 # Minimum seconds between upstream API calls

# -----------------------------------------------------------------------------
# Safety Monitoring
# -----------------------------------------------------------------------------
SAFETY_MONITORING_ENABLED=True

# Safety event thresholds
SAFETY_VS_CHANGE_THRESHOLD=2000              # Vertical speed change (ft/min) for alerts
SAFETY_VS_EXTREME_THRESHOLD=6000             # Extreme vertical speed (ft/min)
SAFETY_PROXIMITY_NM=0.5                      # Proximity alert distance (nautical miles)
SAFETY_ALTITUDE_DIFF_FT=500                  # Altitude difference for proximity (feet)
SAFETY_CLOSURE_RATE_KT=200                   # Closure rate threshold (knots)
SAFETY_TCAS_VS_THRESHOLD=1500                # TCAS vertical speed threshold (ft/min)

# -----------------------------------------------------------------------------
# Default Alerts
# -----------------------------------------------------------------------------
PROXIMITY_ALERT_NM=5.0                       # Default proximity alert radius (nm)
WATCH_ICAO_LIST=                             # Comma-separated ICAO hex codes to watch
WATCH_FLIGHT_LIST=                           # Comma-separated flight numbers to watch
ALERT_MILITARY=True                          # Alert on military aircraft
ALERT_EMERGENCY=True                         # Alert on emergency squawks

# -----------------------------------------------------------------------------
# ACARS/VDL2 Configuration
# -----------------------------------------------------------------------------
ACARS_ENABLED=True
ACARS_PORT=5555
VDLM2_PORT=5556

# -----------------------------------------------------------------------------
# Notifications (Apprise URLs)
# -----------------------------------------------------------------------------
# Format: service1://...,service2://...
# Examples:
#   - telegram://bot_token/chat_id
#   - discord://webhook_id/webhook_token
#   - slack://token_a/token_b/token_c
#   - pushover://user_key/app_token
#   - email://user:password@smtp.example.com
APPRISE_URLS=
NOTIFICATION_COOLDOWN=300                    # Seconds between duplicate notifications

# -----------------------------------------------------------------------------
# Photo Cache
# -----------------------------------------------------------------------------
PHOTO_CACHE_ENABLED=True
PHOTO_AUTO_DOWNLOAD=True
# PHOTO_CACHE_DIR=/data/photos               # Set in docker-compose

# -----------------------------------------------------------------------------
# Radio/Audio
# -----------------------------------------------------------------------------
RADIO_ENABLED=True
RADIO_MAX_FILE_SIZE_MB=50                    # Maximum audio file size
RADIO_RETENTION_DAYS=7                       # Days to keep audio files
# RADIO_AUDIO_DIR=/data/radio                # Set in docker-compose

# -----------------------------------------------------------------------------
# Transcription
# -----------------------------------------------------------------------------
TRANSCRIPTION_ENABLED=False

# External transcription service (optional)
TRANSCRIPTION_SERVICE_URL=
TRANSCRIPTION_MODEL=
TRANSCRIPTION_API_KEY=

# Local Whisper
WHISPER_ENABLED=False
WHISPER_URL=http://whisper:9000

# ATC-Whisper (specialized ATC transcription)
ATC_WHISPER_ENABLED=False
ATC_WHISPER_MAX_CONCURRENT=2                 # Max concurrent transcriptions
ATC_WHISPER_SEGMENT_BY_VAD=True              # Voice activity detection segmentation
ATC_WHISPER_PREPROCESS=True                  # Audio preprocessing
ATC_WHISPER_NOISE_REDUCE=True                # Noise reduction
ATC_WHISPER_POSTPROCESS=True                 # Post-processing cleanup

# -----------------------------------------------------------------------------
# LLM API (Enhanced Transcript Analysis)
# -----------------------------------------------------------------------------
# Optional LLM integration for improved callsign extraction accuracy.
# Supports OpenAI, Anthropic via OpenRouter, and local Ollama.
# Falls back gracefully to regex-only extraction if disabled or unavailable.
#
LLM_ENABLED=False
LLM_API_URL=https://api.openai.com/v1        # OpenAI-compatible API endpoint
LLM_API_KEY=                                 # API key (not needed for local Ollama)
LLM_MODEL=gpt-4o-mini                        # Model to use
LLM_TIMEOUT=30                               # Request timeout in seconds
LLM_MAX_RETRIES=3                            # Max retries on failure
LLM_CACHE_TTL=3600                           # Cache TTL in seconds (1 hour)
LLM_MAX_TOKENS=500                           # Max response tokens
LLM_TEMPERATURE=0.1                          # Lower = more deterministic

# Example configurations:
#
# OpenAI:
#   LLM_ENABLED=True
#   LLM_API_URL=https://api.openai.com/v1
#   LLM_API_KEY=sk-xxx
#   LLM_MODEL=gpt-4o-mini
#
# Local Ollama:
#   LLM_ENABLED=True
#   LLM_API_URL=http://localhost:11434/v1
#   LLM_API_KEY=ollama
#   LLM_MODEL=llama3.2
#
# Anthropic via OpenRouter:
#   LLM_ENABLED=True
#   LLM_API_URL=https://openrouter.ai/api/v1
#   LLM_API_KEY=sk-or-xxx
#   LLM_MODEL=anthropic/claude-3-haiku

# -----------------------------------------------------------------------------
# OpenSky Database
# -----------------------------------------------------------------------------
OPENSKY_DB_ENABLED=True
# OPENSKY_DB_PATH=/data/opensky/aircraft-database.csv  # Set in docker-compose

# -----------------------------------------------------------------------------
# S3 Storage (Optional)
# -----------------------------------------------------------------------------
S3_ENABLED=False
S3_BUCKET=
S3_REGION=us-east-1
S3_ACCESS_KEY=
S3_SECRET_KEY=
S3_ENDPOINT_URL=                             # For S3-compatible storage (MinIO, etc.)
S3_PREFIX=aircraft-photos                    # Prefix for photo storage
S3_PUBLIC_URL=                               # Public URL for serving files
RADIO_S3_PREFIX=radio-transmissions          # Prefix for radio file storage

# -----------------------------------------------------------------------------
# Monitoring (Optional)
# -----------------------------------------------------------------------------
# Sentry error tracking
SENTRY_DSN=
SENTRY_ENVIRONMENT=production
SENTRY_TRACES_SAMPLE_RATE=0.1                # 0.0 to 1.0 for performance tracing
SENTRY_PROFILES_SAMPLE_RATE=0.1              # 0.0 to 1.0 for profiling

# Prometheus metrics
PROMETHEUS_ENABLED=True

# -----------------------------------------------------------------------------
# Development/Testing (used by docker-compose.test.yaml)
# -----------------------------------------------------------------------------
# Dashboard port for web development
DASHBOARD_PORT=3000

# Vite API proxy target (for local dev use localhost, Docker overrides to api:8000)
VITE_API_TARGET=http://localhost:8000

# External ports for mock services
ULTRAFEEDER_PORT_EXTERNAL=8080
DUMP978_PORT_EXTERNAL=8081
ACARSHUB_WEB_PORT=8088

# ACARS Hub Mock
MOCK_ENABLED=true
MOCK_INTERVAL_MIN=1.0
MOCK_INTERVAL_MAX=2.0
STATION_ID=MOCK-STATION
RELAY_HOST=api
RELAY_PORT=5555
RELAY_PROTOCOL=udp

# ACARS UDP/TCP ports for mock services
ACARS_UDP_PORT=5550
VDLM2_UDP_PORT=5555
HFDL_UDP_PORT=5556
IMSL_UDP_PORT=5557
IRDM_UDP_PORT=5558
ACARS_TCP_PORT=15550
VDLM2_TCP_PORT=15555
HFDL_TCP_PORT=15556
IMSL_TCP_PORT=15557
IRDM_TCP_PORT=15558

# ADSBx API key for mock services
ADSBX_API_KEY=

# Node environment for web dev
NODE_ENV=development
AUTH_MODE=public


# Python settings
PYTHONDONTWRITEBYTECODE=1
PYTHONUNBUFFERED=1

# =============================================================================
# Free Data Sources (New in 2.7)
# =============================================================================

# -----------------------------------------------------------------------------
# CheckWX Weather API (https://www.checkwxapi.com/)
# -----------------------------------------------------------------------------
# Free tier: 3,000 requests/day
# Provides pre-decoded METAR/TAF data with flight category calculations
CHECKWX_ENABLED=False
CHECKWX_API_KEY=

# -----------------------------------------------------------------------------
# AVWX Weather API (https://avwx.rest/)
# -----------------------------------------------------------------------------
# Free tier: Unlimited basic requests
# Backup/secondary weather data source
AVWX_ENABLED=True
AVWX_API_KEY=                                # Optional, higher rate limits with key

# -----------------------------------------------------------------------------
# OpenAIP Airspace (https://www.openaip.net/)
# -----------------------------------------------------------------------------
# Free tier: Unlimited with API key
# Provides global airspace boundaries, airports, and navaids
OPENAIP_ENABLED=False
OPENAIP_API_KEY=

# -----------------------------------------------------------------------------
# OpenSky Network Live API (https://opensky-network.org/)
# -----------------------------------------------------------------------------
# Free tier: 4,000 credits/day (8,000 for contributors)
# Provides real-time global aircraft positions (track aircraft outside local range)
OPENSKY_LIVE_ENABLED=False
OPENSKY_USERNAME=
OPENSKY_PASSWORD=

# -----------------------------------------------------------------------------
# ADS-B Exchange Live API (via RapidAPI)
# -----------------------------------------------------------------------------
# Free tier: Limited calls (check current limits)
# Provides unfiltered data (no LADD/PIA blocking)
ADSBX_LIVE_ENABLED=False
ADSBX_RAPIDAPI_KEY=

# -----------------------------------------------------------------------------
# Aviationstack Flight Schedules (https://aviationstack.com/)
# -----------------------------------------------------------------------------
# Free tier: 100 requests/month
# Correlate observed flights with scheduled routes
AVIATIONSTACK_ENABLED=False
AVIATIONSTACK_API_KEY=
