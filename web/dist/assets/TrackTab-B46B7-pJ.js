import{j as e,a,l as r,r as t,p as l,s as n}from"./index-CzQAPNT8.js";import{u as o,M as s}from"./MiniGraph-DCL2IG9Y.js";import{a as i}from"./ReplayControls-BRtxT5Lt.js";function c({telemetry:t,isCollapsed:l,onToggle:n}){var o,s,i;if(!t)return null;const c=t.vr??t.baro_rate??t.geom_rate??null,u=c>0?"climbing":c<0?"descending":"";return e.jsxs("div",{className:"track-telemetry-overlay "+(l?"collapsed":""),role:"region","aria-label":"Aircraft telemetry","aria-expanded":!l,children:[e.jsx("button",{className:"telem-toggle",onClick:n,title:l?"Expand telemetry":"Collapse telemetry","aria-label":l?"Expand telemetry display":"Collapse telemetry display",children:l?e.jsx(a,{size:14,"aria-hidden":"true"}):e.jsx(r,{size:14,"aria-hidden":"true"})}),!l&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"telem-row","aria-live":"polite",children:[e.jsxs("div",{className:"telem-item",children:[e.jsx("span",{className:"telem-label",children:"ALT"}),e.jsx("span",{className:"telem-value",children:(null==(o=t.altitude)?void 0:o.toLocaleString())||"--"}),e.jsx("span",{className:"telem-unit",children:"ft"})]}),e.jsxs("div",{className:"telem-item",children:[e.jsx("span",{className:"telem-label",children:"GS"}),e.jsx("span",{className:"telem-value",children:(null==(s=t.gs)?void 0:s.toFixed(0))||"--"}),e.jsx("span",{className:"telem-unit",children:"kts"})]}),e.jsxs("div",{className:"telem-item",children:[e.jsx("span",{className:"telem-label",children:"VS"}),e.jsx("span",{className:`telem-value ${u}`,children:null!==c?(c>0?"+":"")+c:"--"}),e.jsx("span",{className:"telem-unit",children:"fpm"})]}),e.jsxs("div",{className:"telem-item",children:[e.jsx("span",{className:"telem-label",children:"HDG"}),e.jsx("span",{className:"telem-value",children:(null==(i=t.track)?void 0:i.toFixed(0))||"--"}),e.jsx("span",{className:"telem-unit",children:"Â°"})]})]}),e.jsx("div",{className:"telem-time",children:t.timestamp?new Date(t.timestamp).toLocaleTimeString():"--:--"})]})]})}function u({aircraft:a,sightings:r,feederLocation:u,trackReplayPosition:d,setTrackReplayPosition:m,trackIsPlaying:h,setTrackIsPlaying:f,trackReplaySpeed:p,setTrackReplaySpeed:g,showTrackPoints:k,setShowTrackPoints:v,trackLiveMode:x,setTrackLiveMode:b,showTelemOverlay:j,setShowTelemOverlay:y,graphZoom:T,setGraphZoom:N,graphScrollOffset:S,setGraphScrollOffset:C}){const L=t.useRef(null),M=t.useRef(null),w=t.useRef(null),_=t.useRef(!1),D=t.useRef(null),P=t.useRef(null),{handleGraphWheel:F,handleGraphDragStart:R,handleGraphDragMove:E,handleGraphDragEnd:A,resetGraphZoom:G}=o(T,N,S,C),O=t.useCallback((e,a)=>{const r=e||0;return l.divIcon({className:"track-aircraft-marker",html:`\n        <svg width="24" height="24" viewBox="0 0 24 24" style="transform: rotate(${r}deg)">\n          <path d="M12 2 L14 8 L20 10 L14 12 L14 18 L12 16 L10 18 L10 12 L4 10 L10 8 Z"\n                fill="${a}" stroke="#000" stroke-width="0.5"/>\n        </svg>\n      `,iconSize:[24,24],iconAnchor:[12,12]})},[]),Z=t.useCallback((e,a)=>{if(!e||0===e.length)return null;if(1===e.length)return e[0];const r=[...e].reverse(),t=a/100*(r.length-1),l=Math.floor(t),n=Math.min(l+1,r.length-1),o=t-l;if(l===n||0===o)return r[l];const s=r[l],i=r[n],c=(e,a,r)=>null==e?a:null==a?e:e+(a-e)*r;return{...s,lat:c(s.lat,i.lat,o),lon:c(s.lon,i.lon,o),altitude:Math.round(c(s.altitude,i.altitude,o)),gs:c(s.gs,i.gs,o),vr:Math.round(c(s.vr,i.vr,o)),baro_rate:Math.round(c(s.baro_rate,i.baro_rate,o)),geom_rate:Math.round(c(s.geom_rate,i.geom_rate,o)),track:((e,a,r)=>{if(null==e||null==a)return e;let t=a-e;return t>180&&(t-=360),t<-180&&(t+=360),(e+t*r+360)%360})(s.track,i.track,o),timestamp:s.timestamp}},[]),z=t.useCallback(()=>{if(x&&a)return{lat:a.lat,lon:a.lon,altitude:"ground"!==a.alt_baro?a.alt_baro:a.alt_geom,gs:a.gs,vr:a.baro_rate??a.geom_rate,baro_rate:a.baro_rate,geom_rate:a.geom_rate,track:a.track,timestamp:(new Date).toISOString()};if(!r||0===r.length)return null;const e=r.filter(e=>e.lat&&e.lon);return Z(e,d)},[r,d,Z,x,a]),I=t.useCallback(e=>{if(!e||L.current)return;if(!r||0===r.length)return;const a=r.filter(e=>e.lat&&e.lon);if(0===a.length)return;const t=a[0],n=l.map(e,{center:[t.lat,t.lon],zoom:10,zoomControl:!1,attributionControl:!1});l.tileLayer("https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png",{maxZoom:19}).addTo(n);const o=[...a].reverse().map(e=>[e.lat,e.lon]);o.length>1&&(D.current=l.polyline(o,{color:"#00ff88",weight:3,opacity:.7}).addTo(n)),P.current=l.layerGroup().addTo(n);const s=Math.max(1,Math.floor(a.length/20));a.forEach((e,r)=>{if(r%s===0||0===r||r===a.length-1){const t=r===a.length-1,o=0===r,s=l.circleMarker([e.lat,e.lon],{radius:t||o?6:3,color:o?"#00ff88":t?"#ff8844":"#5a7a9a",fillColor:o?"#00ff88":t?"#ff8844":"#5a7a9a",fillOpacity:.8,weight:1});t||o?s.addTo(n):k&&s.addTo(P.current)}}),(null==u?void 0:u.lat)&&(null==u?void 0:u.lon)&&l.circleMarker([u.lat,u.lon],{radius:8,color:"#ff4444",fillColor:"#ff4444",fillOpacity:.3,weight:2}).addTo(n);const i=Z(a,d);if(i){const e=O(i.track,"#00ff88");M.current=l.marker([i.lat,i.lon],{icon:e}).addTo(n)}if(o.length>1){const e=l.latLngBounds(o);n.fitBounds(e.pad(.1))}L.current=n},[r,u,d,Z,O,k]),W=t.useCallback((e,a=!0)=>{if(!L.current||!r||0===r.length)return;const t=r.filter(e=>e.lat&&e.lon),n=Z(t,e);if(!n)return;M.current&&L.current.removeLayer(M.current);const o=O(n.track,"#00ff88");M.current=l.marker([n.lat,n.lon],{icon:o}).addTo(L.current),a&&L.current.panTo([n.lat,n.lon],{animate:!0,duration:.15})},[r,Z,O]),B=t.useCallback(e=>{e<100&&b(!1),m(e),W(e)},[b,m,W]),K=t.useCallback(()=>{if(_.current)_.current=!1,w.current&&cancelAnimationFrame(w.current),f(!1);else{_.current=!0,b(!1),f(!0);let e=d<=0?0:d,a=performance.now();const r=t=>{if(!_.current)return;const l=t-a;a=t;if(e+=l/200*p,e>=100)return _.current=!1,m(100),W(100),f(!1),void b(!0);m(e),W(e),w.current=requestAnimationFrame(r)};w.current=requestAnimationFrame(r)}},[d,p,m,W,f,b]),$=t.useCallback(()=>{_.current=!1,w.current&&cancelAnimationFrame(w.current),f(!1),b(!1),m(0),W(0)},[f,b,m,W]),q=t.useCallback(()=>{_.current=!1,w.current&&cancelAnimationFrame(w.current),f(!1),b(!0),m(100),W(100)},[f,b,m,W]),V=t.useCallback(()=>{x?b(!1):(_.current=!1,b(!0),m(100),w.current&&cancelAnimationFrame(w.current),f(!1))},[x,b,m,f]);if(t.useEffect(()=>{if(!L.current||!r||0===r.length)return;const e=r.filter(e=>e.lat&&e.lon);if(0===e.length)return;const a=[...e].reverse().map(e=>[e.lat,e.lon]);if(D.current&&D.current.setLatLngs(a),x&&!h){m(100);const a=e[0];if(a&&M.current){L.current.removeLayer(M.current);const e=O(a.track,"#00ff88");M.current=l.marker([a.lat,a.lon],{icon:e}).addTo(L.current),L.current.panTo([a.lat,a.lon],{animate:!0,duration:.3})}}},[r,x,h,O,m]),t.useEffect(()=>{if(!L.current||!x||h)return;if(!(null==a?void 0:a.lat)||!(null==a?void 0:a.lon))return;M.current&&L.current.removeLayer(M.current);const e=O(a.track,"#00ff88");M.current=l.marker([a.lat,a.lon],{icon:e}).addTo(L.current),L.current.panTo([a.lat,a.lon],{animate:!0,duration:.3})},[null==a?void 0:a.lat,null==a?void 0:a.lon,null==a?void 0:a.track,x,h,O]),t.useEffect(()=>{if(L.current&&P.current&&(P.current.clearLayers(),k&&r&&r.length>0)){const e=r.filter(e=>e.lat&&e.lon),a=Math.max(1,Math.floor(e.length/20));e.forEach((r,t)=>{0!==t&&t!==e.length-1&&t%a===0&&l.circleMarker([r.lat,r.lon],{radius:3,color:"#5a7a9a",fillColor:"#5a7a9a",fillOpacity:.8,weight:1}).addTo(P.current)})}},[k,r]),t.useEffect(()=>()=>{L.current&&(L.current.remove(),L.current=null),w.current&&cancelAnimationFrame(w.current)},[]),0===r.length||!r.some(e=>e.lat&&e.lon))return e.jsx("div",{className:"detail-track",id:"panel-track",role:"tabpanel","aria-labelledby":"tab-track",children:e.jsxs("div",{className:"detail-empty",role:"status",children:[e.jsx(n,{size:48,"aria-hidden":"true"}),e.jsx("p",{children:"No track data available"}),e.jsx("span",{children:"No position reports with coordinates in the last 24 hours"})]})});const H=z();return e.jsx("div",{className:"detail-track",id:"panel-track",role:"tabpanel","aria-labelledby":"tab-track",children:e.jsxs("div",{className:"track-replay-container",children:[e.jsx(c,{telemetry:H,isCollapsed:!j,onToggle:()=>y(!j)}),e.jsx("div",{className:"track-map",ref:e=>{e&&!L.current&&setTimeout(()=>I(e),50)},role:"application","aria-label":"Flight track map"}),e.jsx("div",{className:"track-graphs",children:e.jsxs("div",{className:"graphs-row",children:[e.jsx(s,{data:r,dataKey:"altitude",color:"#00ff88",label:"Altitude",unit:"ft",positionPercent:x?null:d,graphZoom:T,graphScrollOffset:S,onWheel:F,onDragStart:R,onDragMove:E,onDragEnd:A,onResetZoom:G}),e.jsx(s,{data:r,dataKey:"gs",color:"#44aaff",label:"Speed",unit:"kts",formatFn:e=>null==e?void 0:e.toFixed(0),positionPercent:x?null:d,graphZoom:T,graphScrollOffset:S,onWheel:F,onDragStart:R,onDragMove:E,onDragEnd:A,onResetZoom:G}),e.jsx(s,{data:r,dataKey:"vr",color:"#ffaa44",label:"V/S",unit:"fpm",formatFn:e=>(e>0?"+":"")+e,positionPercent:x?null:d,graphZoom:T,graphScrollOffset:S,onWheel:F,onDragStart:R,onDragMove:E,onDragEnd:A,onResetZoom:G})]})}),e.jsx(i,{isPlaying:h,position:d,onPlayToggle:K,onSkipToStart:$,onSkipToEnd:q,onPositionChange:B,speed:p,onSpeedChange:g,showTrackPoints:k,onToggleTrackPoints:()=>v(!k),liveMode:x,onToggleLiveMode:V,showSpeedControl:!0,showTrackPointsControl:!0,showLiveModeControl:!0,className:"track-controls"})]})})}export{u as TrackTab};
