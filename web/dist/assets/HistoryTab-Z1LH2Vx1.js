import{r as e,p as r,j as a,H as t,s as l}from"./index-CzQAPNT8.js";import{u as n,M as o}from"./MiniGraph-DCL2IG9Y.js";import{a as s}from"./ReplayControls-BRtxT5Lt.js";function i({sightings:i,feederLocation:c,showTrackMap:d,setShowTrackMap:h,replayPosition:u,setReplayPosition:m,isPlaying:p,setIsPlaying:f,graphZoom:g,setGraphZoom:v,graphScrollOffset:x,setGraphScrollOffset:j}){const y=e.useRef(null),b=e.useRef(null),k=e.useRef(null),{handleGraphWheel:S,handleGraphDragStart:N,handleGraphDragMove:L,handleGraphDragEnd:M,resetGraphZoom:w}=n(g,v,x,j),C=e.useCallback((e,a)=>{const t=e||0;return r.divIcon({className:"history-aircraft-marker",html:`\n        <svg width="24" height="24" viewBox="0 0 24 24" style="transform: rotate(${t}deg)">\n          <path d="M12 2 L14 8 L20 10 L14 12 L14 18 L12 16 L10 18 L10 12 L4 10 L10 8 Z"\n                fill="${a}" stroke="#000" stroke-width="0.5"/>\n        </svg>\n      `,iconSize:[24,24],iconAnchor:[12,12]})},[]),D=e.useCallback((e,r)=>{if(!e||0===e.length)return null;if(1===e.length)return e[0];const a=[...e].reverse(),t=r/100*(a.length-1),l=Math.floor(t),n=Math.min(l+1,a.length-1),o=t-l;if(l===n||0===o)return a[l];const s=a[l],i=a[n],c=(e,r,a)=>null==e?r:null==r?e:e+(r-e)*a;return{...s,lat:c(s.lat,i.lat,o),lon:c(s.lon,i.lon,o),altitude:Math.round(c(s.altitude,i.altitude,o)),gs:c(s.gs,i.gs,o),vr:Math.round(c(s.vr,i.vr,o)),track:((e,r,a)=>{if(null==e||null==r)return e;let t=r-e;return t>180&&(t-=360),t<-180&&(t+=360),(e+t*a+360)%360})(s.track,i.track,o),timestamp:s.timestamp}},[]),T=e.useCallback(e=>{if(!e||y.current)return;if(!i||0===i.length)return;const a=i.filter(e=>e.lat&&e.lon);if(0===a.length)return;const t=a[0],l=r.map(e,{center:[t.lat,t.lon],zoom:10,zoomControl:!0,attributionControl:!1});r.tileLayer("https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png",{maxZoom:19}).addTo(l);const n=[...a].reverse().map(e=>[e.lat,e.lon]);n.length>1&&r.polyline(n,{color:"#00ff88",weight:3,opacity:.7}).addTo(l);const o=Math.max(1,Math.floor(a.length/20));a.forEach((e,t)=>{var n,s;if(t%o===0||0===t||t===a.length-1){const o=t===a.length-1,i=0===t;r.circleMarker([e.lat,e.lon],{radius:o||i?6:3,color:i?"#00ff88":o?"#ff8844":"#5a7a9a",fillColor:i?"#00ff88":o?"#ff8844":"#5a7a9a",fillOpacity:.8,weight:1}).addTo(l).bindPopup(`\n          <b>${new Date(e.timestamp).toLocaleTimeString()}</b><br>\n          Alt: ${(null==(n=e.altitude)?void 0:n.toLocaleString())||"--"} ft<br>\n          Speed: ${(null==(s=e.gs)?void 0:s.toFixed(0))||"--"} kts<br>\n          VS: ${e.vr>0?"+":""}${e.vr||0} fpm\n        `)}}),(null==c?void 0:c.lat)&&(null==c?void 0:c.lon)&&r.circleMarker([c.lat,c.lon],{radius:8,color:"#ff4444",fillColor:"#ff4444",fillOpacity:.3,weight:2}).addTo(l).bindPopup("<b>Feeder Location</b>");const s=D(a,u);if(s){const e=C(s.track,"#00ff88");b.current=r.marker([s.lat,s.lon],{icon:e}).addTo(l)}if(n.length>1){const e=r.latLngBounds(n);l.fitBounds(e.pad(.1))}y.current=l},[i,c,u,D,C]),F=e.useCallback(e=>{if(!y.current||!i||0===i.length)return;const a=i.filter(e=>e.lat&&e.lon),t=D(a,e);if(!t)return;b.current&&y.current.removeLayer(b.current);const l=C(t.track,"#00ff88");b.current=r.marker([t.lat,t.lon],{icon:l}).addTo(y.current)},[i,D,C]),P=e.useCallback(e=>{m(e),F(e)},[m,F]),Z=e.useCallback(()=>{f(e=>{if(e)return k.current&&cancelAnimationFrame(k.current),!1;{let e=u<=0?0:u;const r=()=>{if(e+=.5,e>=100)return m(100),F(100),void f(!1);m(e),F(e),k.current=requestAnimationFrame(r)};return k.current=requestAnimationFrame(r),!0}})},[u,m,F,f]),A=e.useCallback(()=>{k.current&&cancelAnimationFrame(k.current),f(!1),m(0),F(0)},[f,m,F]),E=e.useCallback(()=>{k.current&&cancelAnimationFrame(k.current),f(!1),m(100),F(100)},[f,m,F]),G=e.useCallback(()=>{if(!i||0===i.length)return null;const e=i.filter(e=>e.lat&&e.lon),r=D(e,u);return(null==r?void 0:r.timestamp)?new Date(r.timestamp).toLocaleTimeString():null},[i,u,D]);return e.useEffect(()=>()=>{y.current&&(y.current.remove(),y.current=null),k.current&&cancelAnimationFrame(k.current)},[]),e.useEffect(()=>{!d&&y.current&&(y.current.remove(),y.current=null,b.current=null)},[d]),0===i.length?a.jsx("div",{className:"detail-history",id:"panel-history",role:"tabpanel","aria-labelledby":"tab-history",children:a.jsxs("div",{className:"detail-empty",role:"status",children:[a.jsx(t,{size:48,"aria-hidden":"true"}),a.jsx("p",{children:"No sighting history"}),a.jsx("span",{children:"No position reports recorded in the last 24 hours"})]})}):a.jsx("div",{className:"detail-history",id:"panel-history",role:"tabpanel","aria-labelledby":"tab-history",children:a.jsxs("div",{className:"history-stats",children:[a.jsxs("div",{className:"history-header",children:[a.jsxs("p",{"aria-live":"polite",children:[i.length," position reports in the last 24 hours"]}),a.jsxs("button",{className:"map-toggle-btn "+(d?"active":""),onClick:()=>h(!d),"aria-pressed":d,children:[a.jsx(l,{size:16,"aria-hidden":"true"}),d?"Hide Map":"Show Map"]})]}),d&&i.some(e=>e.lat&&e.lon)&&a.jsxs("div",{className:"history-map-container",children:[a.jsx("div",{className:"history-map",ref:e=>{e&&d&&!y.current&&setTimeout(()=>T(e),50)},role:"application","aria-label":"Flight history map"}),a.jsx("div",{className:"flight-graphs",children:a.jsxs("div",{className:"graphs-row",children:[a.jsx(o,{data:i,dataKey:"altitude",color:"#00ff88",label:"Altitude",unit:"ft",graphZoom:g,graphScrollOffset:x,onWheel:S,onDragStart:N,onDragMove:L,onDragEnd:M,onResetZoom:w}),a.jsx(o,{data:i,dataKey:"gs",color:"#44aaff",label:"Speed",unit:"kts",formatFn:e=>null==e?void 0:e.toFixed(0),graphZoom:g,graphScrollOffset:x,onWheel:S,onDragStart:N,onDragMove:L,onDragEnd:M,onResetZoom:w}),a.jsx(o,{data:i,dataKey:"vr",color:"#ffaa44",label:"V/S",unit:"fpm",formatFn:e=>(e>0?"+":"")+e,graphZoom:g,graphScrollOffset:x,onWheel:S,onDragStart:N,onDragMove:L,onDragEnd:M,onResetZoom:w})]})}),a.jsx(s,{isPlaying:p,position:u,timestamp:G(),onPlayToggle:Z,onSkipToStart:A,onSkipToEnd:E,onPositionChange:P,showSpeedControl:!1}),a.jsxs("div",{className:"history-map-legend",children:[a.jsxs("div",{className:"legend-item",children:[a.jsx("span",{className:"legend-marker",style:{background:"#00ff88"}}),a.jsx("span",{children:"Current Position"})]}),a.jsxs("div",{className:"legend-item",children:[a.jsx("span",{className:"legend-marker",style:{background:"#ff8844"}}),a.jsx("span",{children:"Start"})]}),(null==c?void 0:c.lat)&&a.jsxs("div",{className:"legend-item",children:[a.jsx("span",{className:"legend-marker",style:{background:"#ff4444"}}),a.jsx("span",{children:"Feeder"})]})]})]}),a.jsxs("div",{className:"history-table",role:"table","aria-label":"Position history",children:[a.jsxs("div",{className:"history-row header",role:"row",children:[a.jsx("span",{role:"columnheader",children:"Time"}),a.jsx("span",{role:"columnheader",children:"Alt (ft)"}),a.jsx("span",{role:"columnheader",children:"Speed (kts)"}),a.jsx("span",{role:"columnheader",children:"Dist (nm)"})]}),i.slice(0,50).map((e,r)=>{var t,l,n;return a.jsxs("div",{className:"history-row",role:"row",children:[a.jsx("span",{role:"cell",children:new Date(e.timestamp).toLocaleTimeString()}),a.jsx("span",{role:"cell",children:(null==(t=e.altitude)?void 0:t.toLocaleString())||"--"}),a.jsx("span",{role:"cell",children:(null==(l=e.gs)?void 0:l.toFixed(0))||"--"}),a.jsx("span",{role:"cell",children:(null==(n=e.distance_nm)?void 0:n.toFixed(1))||"--"})]},r)})]})]})})}export{i as HistoryTab};
